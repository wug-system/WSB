<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WSB - Waktu Sekolah Bercanda</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    .answer-btn { transition: all 0.3s ease; border: 2px solid transparent; }
    .answer-btn:hover { transform: translateY(-4px); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
    .correct { background-color: rgba(16, 185, 129, 0.4) !important; border-color: #10b981 !important; animation: correctPulse 0.8s ease; }
    .wrong { background-color: rgba(239, 68, 68, 0.4) !important; border-color: #ef4444 !important; animation: wrongShake 0.6s ease; }
    @keyframes correctPulse { 0% { transform: scale(1); } 50% { transform: scale(1.06); } 100% { transform: scale(1); } }
    @keyframes wrongShake { 0%,100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 50% { transform: translateX(8px); } 75% { transform: translateX(-8px); } }
    #timer.low { color: #ef4444; animation: pulse 1s infinite; }
    #timer.medium { color: #fbbf24; }
    @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.6; } }
    .subject-card { transition: all 0.3s; }
    .subject-card:hover { transform: translateY(-8px); box-shadow: 0 15px 30px rgba(0,0,0,0.4); }
    #subjectsGrid { 
      max-height: 60vh; 
      overflow-y: auto; 
      padding: 1.5rem; 
      border-radius: 1rem; 
      background: rgba(30,41,59,0.6); 
      scrollbar-width: thin; 
    }
    #subjectsGrid::-webkit-scrollbar { width: 8px; }
    #subjectsGrid::-webkit-scrollbar-thumb { background: #64748b; border-radius: 4px; }
    #subjectsGrid::-webkit-scrollbar-track { background: transparent; }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-950 via-indigo-950 to-slate-900 text-slate-100 min-h-screen">

<div class="max-w-6xl mx-auto px-4 py-8">
  <header class="flex justify-between items-center mb-12">
    <div class="flex items-center gap-4">
      <div class="w-16 h-16 bg-gradient-to-br from-green-600 to-emerald-700 rounded-2xl flex items-center justify-center text-4xl shadow-2xl shadow-green-500/40">üòÜ</div>
      <div>
        <h1 class="text-4xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-green-400 to-emerald-400">WSB</h1>
        <p class="text-slate-400 font-medium">Waktu Sekolah Bercanda ‚Äì Belajar Sambil Ketawa!</p>
      </div>
    </div>
    <button id="configBtn" class="bg-slate-800/80 hover:bg-slate-700 px-6 py-3 rounded-xl transition flex items-center gap-2 backdrop-blur-sm border border-slate-700 shadow-lg">
      <i class="fas fa-cog"></i> Pengaturan
    </button>
  </header>

  <div id="startScreen" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 backdrop-blur-md">
    <div class="bg-slate-900/90 p-8 md:p-12 rounded-3xl border border-slate-600 max-w-5xl w-full text-center shadow-2xl overflow-hidden">
      <h2 class="text-4xl md:text-5xl font-extrabold mb-6 bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent">Selamat Datang di WSB!</h2>
      <p class="text-lg md:text-xl text-slate-300 mb-10 md:mb-12">Pilih tingkat kelasmu, lalu mata pelajaran yang mau dibecandain!</p>

      <div class="grid gap-6 grid-cols-1 sm:grid-cols-3 mb-12 md:mb-16">
        <button onclick="selectLevel('sd')" class="bg-gradient-to-br from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 py-10 rounded-2xl font-bold text-xl shadow-xl transition transform hover:scale-105 hover:shadow-2xl">
          <i class="fas fa-child text-5xl mb-4 block"></i>SD
        </button>
        <button onclick="selectLevel('smp')" class="bg-gradient-to-br from-teal-600 to-cyan-600 hover:from-teal-500 hover:to-cyan-500 py-10 rounded-2xl font-bold text-xl shadow-xl transition transform hover:scale-105 hover:shadow-2xl">
          <i class="fas fa-graduation-cap text-5xl mb-4 block"></i>SMP
        </button>
        <button onclick="selectLevel('sma')" class="bg-gradient-to-br from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 py-10 rounded-2xl font-bold text-xl shadow-xl transition transform hover:scale-105 hover:shadow-2xl">
          <i class="fas fa-user-graduate text-5xl mb-4 block"></i>SMA/SMK
        </button>
      </div>

      <div id="subjectSelection" class="hidden">
        <h3 class="text-3xl font-bold mb-8">Pilih Mata Pelajaran</h3>
        <div id="subjectsGrid" class="grid gap-6 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"></div>
      </div>
    </div>
  </div>

  <div id="gameArea" class="hidden">
    <div class="bg-slate-900/70 backdrop-blur-lg p-6 md:p-8 rounded-3xl border border-slate-700/50 shadow-2xl">
      <div class="flex flex-col sm:flex-row justify-between items-center mb-8 gap-4">
        <div class="text-xl font-medium">
          Pertanyaan <span id="qNumber" class="font-bold text-green-400">1</span> dari <span id="totalQ"></span>
        </div>
        <div class="flex items-center gap-6">
          <div class="flex items-center gap-3">
            <span class="text-yellow-400 text-2xl">‚≠ê</span>
            <span id="score" class="font-bold text-3xl">0</span>
          </div>
          <div class="flex items-center gap-3">
            <span id="timer" class="font-bold text-3xl text-emerald-400">30</span>
            <span class="text-slate-400 text-lg">detik</span>
          </div>
        </div>
      </div>

      <div id="question" class="text-xl md:text-3xl font-semibold mb-8 md:mb-10 text-center min-h-[80px] md:min-h-[100px] leading-relaxed"></div>

      <div id="options" class="grid gap-4 md:gap-5 grid-cols-1 md:grid-cols-2"></div>

      <div id="feedback" class="mt-8 md:mt-10 text-xl md:text-2xl font-bold text-center feedback hidden"></div>
    </div>
  </div>

  <div id="settingsModal" class="fixed inset-0 bg-black/80 hidden z-50 items-center justify-center backdrop-blur-sm">
    <div class="bg-slate-900 p-8 md:p-10 rounded-3xl border border-slate-700 w-full max-w-lg shadow-2xl">
      <h2 class="text-3xl font-bold mb-8 text-center">Pengaturan WSB</h2>
      <div class="text-center text-slate-300 mb-6">Belum ada pengaturan khusus nih, tapi nanti bisa tambah nama, tema, dll!</div>
      <div class="flex justify-center">
        <button id="closeSettings" class="px-10 py-4 bg-green-600 hover:bg-green-500 rounded-2xl transition font-bold">Tutup</button>
      </div>
    </div>
  </div>
</div>

<script>
// ================= STATE =================
let currentGame = {
  level: null,
  subject: null,
  questions: [],
  currentIndex: 0,
  score: 0,
  timeLeft: 30,
  timerId: null
};

const elements = {
  startScreen: document.getElementById('startScreen'),
  subjectSelection: document.getElementById('subjectSelection'),
  subjectsGrid: document.getElementById('subjectsGrid'),
  gameArea: document.getElementById('gameArea'),
  questionEl: document.getElementById('question'),
  optionsEl: document.getElementById('options'),
  feedbackEl: document.getElementById('feedback'),
  scoreEl: document.getElementById('score'),
  timerEl: document.getElementById('timer'),
  qNumberEl: document.getElementById('qNumber'),
  totalQEl: document.getElementById('totalQ')
};

const subjects = {
  sd: [
    { name: "Bahasa Indonesia", icon: "fas fa-book-open", color: "indigo" },
    { name: "Matematika", icon: "fas fa-square-root-variable", color: "emerald" },
    { name: "IPA", icon: "fas fa-flask", color: "blue" },
    { name: "IPS", icon: "fas fa-globe-asia", color: "purple" },
    { name: "Bahasa Jepang", icon: "fas fa-language", color: "red" },
    { name: "PPS", icon: "fas fa-landmark", color: "yellow" }
  ],
  smp: [
    { name: "Bahasa Indonesia", icon: "fas fa-book-open", color: "indigo" },
    { name: "Matematika", icon: "fas fa-square-root-variable", color: "emerald" },
    { name: "IPA", icon: "fas fa-flask", color: "blue" },
    { name: "IPS", icon: "fas fa-globe-asia", color: "purple" },
    { name: "Bahasa Jepang", icon: "fas fa-language", color: "red" },
    { name: "PPS", icon: "fas fa-landmark", color: "yellow" }
  ],
  sma: [
    { name: "Bahasa Indonesia", icon: "fas fa-book-open", color: "indigo" },
    { name: "Matematika", icon: "fas fa-square-root-variable", color: "emerald" },
    { name: "Fisika", icon: "fas fa-atom", color: "cyan" },
    { name: "Ekonomi", icon: "fas fa-chart-line", color: "amber" },
    { name: "Bahasa Jepang", icon: "fas fa-language", color: "red" },
    { name: "PPS", icon: "fas fa-landmark", color: "yellow" }
  ]
};

// ================= LOAD SOAL DARI JSON =================
let allSoal = [];

async function loadSoal() {
  try {
    const response = await fetch('soal.json');
    if (!response.ok) throw new Error('Gagal load soal.json');
    allSoal = await response.json();
    console.log(`Berhasil load ${allSoal.length} soal dari soal.json`);
  } catch (error) {
    console.error("Error load soal.json:", error);
    alert("Gagal memuat soal. Cek file soal.json di repo ya bro!");
  }
}

// Fungsi ambil soal berdasarkan tingkat & mapel
function getSoal(tingkat, mapel) {
  return allSoal.filter(s => s.tingkat === tingkat && s.mapel === mapel);
}

// ================= INIT =================
document.addEventListener('DOMContentLoaded', async () => {
  await loadSoal();

  document.getElementById('configBtn').addEventListener('click', () => {
    document.getElementById('settingsModal').classList.remove('hidden');
    document.getElementById('settingsModal').classList.add('flex');
  });

  document.getElementById('closeSettings').addEventListener('click', () => {
    document.getElementById('settingsModal').classList.add('hidden');
  });

  window.selectLevel = function(level) {
    currentGame.level = level;
    elements.subjectSelection.classList.remove('hidden');
    renderSubjects(level);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  function renderSubjects(level) {
    elements.subjectsGrid.innerHTML = '';
    subjects[level].forEach(sub => {
      const card = document.createElement('button');
      card.className = `subject-card bg-gradient-to-br from-${sub.color}-600 to-${sub.color}-500 hover:from-${sub.color}-500 hover:to-${sub.color}-400 p-6 md:p-8 rounded-2xl font-bold text-lg md:text-xl shadow-xl transition transform hover:scale-105 hover:shadow-2xl text-white flex flex-col items-center justify-center`;
      card.innerHTML = `<i class="${sub.icon} text-4xl md:text-5xl mb-4"></i>${sub.name}`;
      card.addEventListener('click', () => startGameWithSubject(sub.name));
      elements.subjectsGrid.appendChild(card);
    });
  }

  window.startGameWithSubject = function(subjectName) {
    currentGame.subject = subjectName;
    currentGame.questions = getSoal(currentGame.level, subjectName);
    currentGame.currentIndex = 0;
    currentGame.score = 0;
    currentGame.timeLeft = 30;

    elements.startScreen.classList.add('hidden');
    elements.gameArea.classList.remove('hidden');
    elements.totalQEl.textContent = currentGame.questions.length;

    if (currentGame.questions.length === 0) {
      elements.questionEl.textContent = "Belum ada soal untuk mapel ini bro. Sabar ya, lagi ditambahin!";
      return;
    }

    nextQuestion();
  };

  function nextQuestion() {
    if (currentGame.currentIndex >= currentGame.questions.length) {
      endGame();
      return;
    }

    const q = currentGame.questions[currentGame.currentIndex];
    elements.questionEl.textContent = q.pertanyaan || q.q;
    elements.qNumberEl.textContent = currentGame.currentIndex + 1;
    elements.scoreEl.textContent = currentGame.score;

    elements.optionsEl.innerHTML = '';
    const shuffled = [...(q.pilihan || q.a)].sort(() => Math.random() - 0.5);

    shuffled.forEach((ans) => {
      const btn = document.createElement('button');
      btn.className = 'answer-btn w-full bg-slate-800/80 hover:bg-slate-700 p-5 md:p-6 rounded-2xl text-left text-base md:text-lg border-2 border-slate-600 backdrop-blur-sm transition';
      btn.textContent = ans;
      btn.addEventListener('click', () => checkAnswer(ans === q.pilihan[q.jawabanBenar] || ans === q.a[q.correct], btn, q.pilihan[q.jawabanBenar] || q.a[q.correct]));
      elements.optionsEl.appendChild(btn);
    });

    startTimer();
  }

  function startTimer() {
    if (currentGame.timerId) clearInterval(currentGame.timerId);

    currentGame.timeLeft = 30;
    elements.timerEl.textContent = currentGame.timeLeft;
    elements.timerEl.className = 'font-bold text-2xl md:text-3xl text-emerald-400';

    currentGame.timerId = setInterval(() => {
      currentGame.timeLeft--;
      elements.timerEl.textContent = currentGame.timeLeft;

      if (currentGame.timeLeft <= 10) elements.timerEl.classList.add('low');
      else if (currentGame.timeLeft <= 20) elements.timerEl.classList.add('medium');

      if (currentGame.timeLeft <= 0) {
        clearInterval(currentGame.timerId);
        showFeedback(false, "Waktu habis bro!");
        setTimeout(nextQuestion, 2500);
      }
    }, 1000);
  }

  function checkAnswer(isCorrect, clickedBtn, correctAnswer) {
    clearInterval(currentGame.timerId);
    document.querySelectorAll('.answer-btn').forEach(btn => btn.disabled = true);

    if (isCorrect) {
      currentGame.score += 10 + Math.floor(currentGame.timeLeft / 2);
      clickedBtn.classList.add('correct');
      showFeedback(true, `Bener bro! +${10 + Math.floor(currentGame.timeLeft / 2)} poin`);
    } else {
      clickedBtn.classList.add('wrong');
      showFeedback(false, `Salah bro! Jawaban bener: <span class="text-emerald-300 font-bold">${correctAnswer}</span>`);
    }

    setTimeout(() => {
      currentGame.currentIndex++;
      nextQuestion();
    }, 2800);
  }

  function showFeedback(isCorrect, message) {
    elements.feedbackEl.innerHTML = message;
    elements.feedbackEl.className = isCorrect 
      ? 'text-emerald-400 text-xl md:text-2xl font-bold animate-pop feedback' 
      : 'text-rose-400 text-xl md:text-2xl font-bold animate-pop feedback';
    elements.feedbackEl.classList.remove('hidden');
    setTimeout(() => elements.feedbackEl.classList.add('hidden'), 2500);
  }

  function endGame() {
    elements.gameArea.innerHTML = `
      <div class="text-center py-16 md:py-24">
        <h2 class="text-5xl md:text-6xl font-extrabold mb-6 bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent">Selesai Bro!</h2>
        <p class="text-3xl md:text-4xl mb-8">Skor Akhir: <span class="font-black text-emerald-400">${currentGame.score}</span></p>
        <p class="text-xl md:text-2xl text-slate-300 mb-10">Mapel: ${currentGame.subject} - Kelas ${currentGame.level.toUpperCase()}</p>
        <button onclick="location.reload()" class="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 px-10 md:px-12 py-5 md:py-6 rounded-3xl text-xl md:text-2xl font-bold transition transform hover:scale-110 shadow-2xl">
          Main Lagi Dong!
        </button>
      </div>
    `;
  }
});
</script>
</body>
</html>
